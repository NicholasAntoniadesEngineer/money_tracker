<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Budget - Money Tracker</title>
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="icon" href="data:,">
</head>
<body>
    <header class="main-header">
        <nav class="main-navigation" role="navigation" aria-label="Main navigation">
            <h1 class="site-title">Money Tracker</h1>
            <ul class="nav-list">
                <li><a href="../index.html" class="nav-link">Home</a></li>
                <li><a href="monthly-budget.html" class="nav-link active" aria-current="page">Monthly Budget</a></li>
                <li><a href="pots.html" class="nav-link">Pots & Investments</a></li>
                <li><a href="overview.html" class="nav-link">Overview</a></li>
            </ul>
        </nav>
    </header>

    <main class="budget-main" role="main">
        <section class="month-selector-section form-section">
            <div class="form-group">
                <label for="month-selector" class="form-label">Select Month:</label>
                <div style="display: flex; gap: 0.5rem; align-items: flex-end; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 200px;">
                <select id="month-selector" class="form-select">
                    <option value="">Loading...</option>
                </select>
                    </div>
                    <button id="create-month-button" class="btn btn-primary">Create New Month</button>
                    <button id="delete-month-button" class="btn btn-danger" style="display: none;">Delete Month</button>
                </div>
            </div>
            
            <div class="form-group" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                <label class="form-label">File Operations:</label>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <button id="load-months-button" class="btn btn-secondary">Load Months from Files</button>
                    <button id="save-all-months-button" class="btn btn-secondary">Save All Months to Files</button>
                    <input type="file" id="file-input" multiple accept=".json,.html" style="display: none;">
                </div>
                <p class="form-help-text" style="margin-top: 0.5rem; font-size: 0.85rem; color: var(--text-secondary);">
                    <strong>Load Months from Files:</strong> Click to select the <code>data/months/</code> folder (modern browsers) or individual JSON/HTML files (all browsers).<br/>
                    <strong>Save All Months to Files:</strong> Save all months to the <code>data/months/</code> folder (modern browsers) or download files (all browsers).<br/>
                    <em>Note: You can load both JSON files (from data/months/) and HTML files (from reference/). HTML files will be automatically imported.</em>
                </p>
                <div id="file-operations-status" style="margin-top: 0.5rem; font-size: 0.9rem;"></div>
            </div>
        </section>

        <div id="month-content" style="display: none;">
            <section class="month-header-section">
                <h2 id="month-title" class="section-title"></h2>
            </section>

            <section class="working-section form-section">
                <h2 class="section-title">The Working Section (The Important One)</h2>
                <p class="section-description">The heart of the system — split into weekly blocks. Each week shows payments due, groceries (with running calculations), transport (with running calculations), activities (with running calculations), and weekly estimate/actual for joint account.</p>
                <button id="add-weekly-breakdown-button" class="btn btn-secondary">Add Week</button>
                <table class="data-table" id="weekly-breakdown-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Payments Due</th>
                            <th>Groceries</th>
                            <th>Transport</th>
                            <th>Activities</th>
                            <th>Estimate</th>
                            <th>Actual</th>
                        </tr>
                    </thead>
                    <tbody id="weekly-breakdown-tbody">
                    </tbody>
                    <tfoot>
                        <tr class="total-row">
                            <td><strong>TOTALS</strong></td>
                            <td id="weekly-breakdown-total-payments"></td>
                            <td id="weekly-breakdown-total-groceries"></td>
                            <td id="weekly-breakdown-total-transport"></td>
                            <td id="weekly-breakdown-total-activities"></td>
                            <td id="weekly-breakdown-total-estimate"><strong>£0.00</strong></td>
                            <td id="weekly-breakdown-total-actual"><strong>£0.00</strong></td>
                        </tr>
                    </tfoot>
                </table>
            </section>

            <section class="income-section form-section">
                <h2 class="section-title">1. Income Overview (Estimated vs Actual)</h2>
                <p class="section-description">At the start of each month, write down how much you expect to earn, how much I expect to earn, and any other income.</p>
                <button id="add-income-button" class="btn btn-secondary">Add Income Source</button>
                <table class="data-table" id="income-table">
                    <thead>
                        <tr>
                            <th>Revenue Source</th>
                            <th>Estimated Amount</th>
                            <th>Actual Amount</th>
                            <th>Date</th>
                            <th>Description</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="income-tbody">
                    </tbody>
                    <tfoot>
                        <tr class="total-row">
                            <td><strong>Total Income</strong></td>
                            <td id="income-total-estimated"><strong>£0.00</strong></td>
                            <td id="income-total-actual"><strong>£0.00</strong></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </section>

            <section class="fixed-costs-section form-section">
                <h2 class="section-title">2. Fixed Costs (Recurring Bills)</h2>
                <p class="section-description">All predictable expenses that come out every month — rent, subscriptions, gym, storage, transport, etc. Track estimated, actual, date, and which card.</p>
                <button id="add-fixed-cost-button" class="btn btn-secondary">Add Fixed Cost</button>
                <table class="data-table" id="fixed-costs-table">
                    <thead>
                        <tr>
                            <th>Expense Category</th>
                            <th>Estimated Amount</th>
                            <th>Actual Amount</th>
                            <th>Date</th>
                            <th>Card</th>
                            <th>Paid</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="fixed-costs-tbody">
                    </tbody>
                    <tfoot>
                        <tr class="total-row">
                            <td><strong>Total Fixed Costs</strong></td>
                            <td id="fixed-costs-total-estimated"><strong>£0.00</strong></td>
                            <td id="fixed-costs-total-actual"><strong>£0.00</strong></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </section>

            <section class="variable-costs-section form-section">
                <h2 class="section-title">3. Variable Costs (Food + Activities)</h2>
                <p class="section-description">The two categories we can control. Assign a monthly budget for each.</p>
                <table class="data-table" id="variable-costs-table">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Monthly Budget</th>
                            <th>Actual Spent</th>
                            <th>Remaining</th>
                        </tr>
                    </thead>
                    <tbody id="variable-costs-tbody">
                    </tbody>
                    <tfoot>
                        <tr class="total-row">
                            <td><strong>Total Variable Costs</strong></td>
                            <td id="variable-costs-total-budget"><strong>£0.00</strong></td>
                            <td id="variable-costs-total-actual"><strong>£0.00</strong></td>
                            <td id="variable-costs-total-remaining"><strong>£0.00</strong></td>
                        </tr>
                    </tfoot>
                </table>
            </section>

            <section class="unplanned-expenses-section form-section">
                <h2 class="section-title">4. Unplanned Buying</h2>
                <p class="section-description">Catch-all section for things we didn't budget for but end up buying anyway (new jeans, spontaneous book, one-off fee, anything unexpected).</p>
                <button id="add-unplanned-expense-button" class="btn btn-secondary">Add Unplanned Expense</button>
                <table class="data-table" id="unplanned-expenses-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Amount</th>
                            <th>Date</th>
                            <th>Card</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="unplanned-expenses-tbody">
                    </tbody>
                    <tfoot>
                        <tr class="total-row">
                            <td><strong>Total Unplanned Expenses</strong></td>
                            <td id="unplanned-expenses-total"><strong>£0.00</strong></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </section>

            <section class="summary-section form-section">
                <h2 class="section-title">5. End-of-Month Summary</h2>
                <p class="section-description">All income minus all expenses (fixed + variable + unplanned) = what's left over / the savings total for the month.</p>
                <table class="data-table" id="summary-table">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Estimated Amount</th>
                            <th>Actual Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Total Income</strong></td>
                            <td id="summary-income-estimated"><strong>£0.00</strong></td>
                            <td id="summary-income-actual"><strong>£0.00</strong></td>
                        </tr>
                        <tr>
                            <td>Total Fixed Costs</td>
                            <td id="summary-fixed-costs-estimated">£0.00</td>
                            <td id="summary-fixed-costs-actual">£0.00</td>
                        </tr>
                        <tr>
                            <td>Total Variable Costs</td>
                            <td id="summary-variable-costs-estimated">£0.00</td>
                            <td id="summary-variable-costs-actual">£0.00</td>
                        </tr>
                        <tr>
                            <td><strong>Total Expenses</strong></td>
                            <td id="summary-expenses-estimated"><strong>£0.00</strong></td>
                            <td id="summary-expenses-actual"><strong>£0.00</strong></td>
                        </tr>
                        <tr>
                            <td>Total Unplanned Expenses</td>
                            <td>—</td>
                            <td id="summary-unplanned-actual">£0.00</td>
                        </tr>
                        <tr class="total-row">
                            <td><strong><em>Grand Savings Total</em></strong></td>
                            <td id="summary-savings-estimated"><strong><em>£0.00</em></strong></td>
                            <td id="summary-savings-actual"><strong><em>£0.00</em></strong></td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section class="save-section form-section">
                <h3 class="section-title">Save Data</h3>
                <p class="section-description" style="font-size: 0.9rem; margin-bottom: 1rem;">
                    <strong>Data Storage:</strong> All data is stored as individual JSON files in <code>data/months/</code> folder.<br/>
                    When you save, the file will be saved directly (modern browsers) or downloaded (older browsers).
                </p>
                <button id="save-month-button" class="btn btn-primary btn-success" style="font-size: 1.25rem; padding: 1rem 2rem;">Save Month Data</button>
            </section>
        </div>

        <div id="no-month-message" style="text-align: center; padding: 3rem;">
            <p class="empty-message">No month selected. Please select a month from the dropdown or create a new one.</p>
        </div>
    </main>

    <footer class="main-footer" role="contentinfo">
        <p>&copy; 2025 Money Tracker. All data stored locally in your browser.</p>
    </footer>

    <script src="../models/DataManager.js"></script>
    <script src="../utils/formatters.js"></script>
    <script src="../utils/ReferenceImporter.js"></script>
    <script src="../utils/InitialData.js"></script>
    <script src="../controllers/MonthlyBudgetController.js"></script>
    <script>
        // Initialize settings
        DataManager.initializeSettings();
        
        // Verify ReferenceImporter is loaded
        if (!window.ReferenceImporter) {
            console.error('ReferenceImporter not loaded! HTML file imports will not work.');
        } else {
            console.log('ReferenceImporter loaded successfully');
        }
        
        // Initialize controller when DOM is ready
        document.addEventListener('DOMContentLoaded', async function() {
            // Now initialize the controller (it will handle loading months)
            if (window.MonthlyBudgetController) {
                await window.MonthlyBudgetController.init();
            }
        });
    </script>
</body>
</html>

