<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pots & Investments - Money Tracker</title>
    <style>
/* ===== styles/main.css ===== */
/* ============================================================================
   MONEY TRACKER - MAIN STYLESHEET
   Imports all CSS modules in dependency order
   ============================================================================ */

/* Core Foundation */
@import url('variables.css');
@import url('reset.css');
@import url('typography.css');
@import url('layout.css');

/* Components */
@import url('components/navigation.css');
@import url('components/forms.css');
@import url('components/tables.css');
@import url('components/buttons.css');
@import url('components/cards.css');

/* Views */
@import url('views/landing.css');
@import url('views/monthly-budget.css');
@import url('views/overview.css');
@import url('views/pots.css');
@import url('views/settings.css');

/* Utilities & Responsive */
@import url('utilities.css');
@import url('responsive.css');
@import url('print.css');

</style>
    <link rel="icon" href="data:,">
</head>
<body>
    <!-- Header will be injected by Header.js -->

    <main class="pots-main" role="main">
        <section class="hero-section hero-section-pots">
            <h2 class="hero-title">Pots & Investments</h2>
        </section>

        <section class="summary-section">
            <div class="summary-grid">
                <div class="summary-card">
                    <div class="summary-card-title">Total Pots (Estimated)</div>
                    <div id="total-pots-estimated" class="summary-card-value">£0.00</div>
                </div>
                <div class="summary-card">
                    <div class="summary-card-title">Total Pots (Actual)</div>
                    <div id="total-pots-actual" class="summary-card-value">£0.00</div>
                </div>
            </div>
        </section>

        <section class="pots-list-section form-section" style="margin-bottom: 1rem;">
            <h2 class="section-title">All Pots</h2>
            <div class="pots-table-container" style="background-color: rgba(213, 213, 213, 0.85); padding: 1rem; border-radius: 0px; border: var(--border-width-thin) solid var(--border-color-black);">
                <table class="data-table" id="pots-table" style="background-color: rgba(213, 213, 213, 0.85);">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Estimated Amount</th>
                        <th>Actual Amount</th>
                        <th class="delete-column-header"></th>
                    </tr>
                </thead>
                <tbody id="pots-tbody">
                </tbody>
            </table>
            </div>
            <div style="margin-top: 1rem;">
                <button id="add-pot-button" class="btn btn-action">Add New Pot</button>
            </div>
        </section>

        <section class="pots-by-month-section form-section">
            <h2 class="section-title">Pots by Month</h2>
            <div id="pots-by-month-container">
                <p class="loading-message">Loading monthly pot data...</p>
            </div>
        </section>
    </main>

    <footer class="main-footer" role="contentinfo">
        <p>&copy; 2025 Money Tracker. All data stored locally in your browser.</p>
    </footer>

    
    
    
    
    
    
    
    
    
    
    
    
<script>
// ===== components/Header.js =====
/**
 * Shared Header Component
 * Renders consistent navigation header across all pages
 */

class Header {
    /**
     * Get the current page name from the current URL
     */
    static getCurrentPage() {
        const path = window.location.pathname;
        const filename = path.split('/').pop() || 'index.html';
        
        if (filename === 'index.html' || filename === '') {
            return 'Home';
        } else if (filename.includes('monthly-budget')) {
            return 'Monthly Budget';
        } else if (filename.includes('pots')) {
            return 'Pots & Investments';
        } else if (filename.includes('settings')) {
            return 'Settings';
        } else if (filename.includes('import')) {
            return 'Settings';
        }
        return 'Home';
    }

    /**
     * Get the base path for navigation links
     */
    static getBasePath() {
        const path = window.location.pathname;
        // If we're in the views folder, go up one level
        if (path.includes('/views/')) {
            return '../';
        }
        return '';
    }

    /**
     * Render the header HTML
     */
    static render() {
        const currentPage = this.getCurrentPage();
        const basePath = this.getBasePath();
        
        const navItems = [
            { name: 'Home', href: basePath + 'index.html', page: 'Home' },
            { name: 'Monthly Budget', href: basePath + 'views/monthly-budget.html', page: 'Monthly Budget' },
            { name: 'Pots & Investments', href: basePath + 'views/pots.html', page: 'Pots & Investments' },
            { name: 'Settings', href: basePath + 'views/settings.html', page: 'Settings' }
        ];

        const navLinks = navItems.map(item => {
            const isActive = item.page === currentPage;
            const activeClass = isActive ? ' active' : '';
            const ariaCurrent = isActive ? ' aria-current="page"' : '';
            return `<li><a href="${item.href}" class="nav-link${activeClass}"${ariaCurrent}>${item.name}</a></li>`;
        }).join('\n                ');

        return `
    <header class="main-header">
        <nav class="main-navigation" role="navigation" aria-label="Main navigation">
            <div class="header-title-group">
                <h1 class="site-title">Money Tracker</h1>
                <button class="hamburger-menu" aria-label="Toggle navigation menu" aria-expanded="false">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
            </div>
            <ul class="nav-list">
                ${navLinks}
            </ul>
        </nav>
    </header>`;
    }

    /**
     * Initialize and inject header into the page
     */
    static init() {
        // Find where to insert the header (before main or body's first child)
        const main = document.querySelector('main');
        const body = document.body;
        
        if (main) {
            // Insert before main element
            main.insertAdjacentHTML('beforebegin', this.render());
        } else if (body) {
            // Insert as first child of body
            body.insertAdjacentHTML('afterbegin', this.render());
        } else {
            console.error('Header: Could not find insertion point');
            return;
        }

        // Initialize hamburger menu functionality
        this.initHamburgerMenu();
    }

    /**
     * Initialize hamburger menu functionality
     */
    static initHamburgerMenu() {
        const hamburgerBtn = document.querySelector('.hamburger-menu');
        const navList = document.querySelector('.nav-list');

        if (!hamburgerBtn || !navList) return;

        hamburgerBtn.addEventListener('click', () => {
            const isExpanded = hamburgerBtn.getAttribute('aria-expanded') === 'true';
            hamburgerBtn.setAttribute('aria-expanded', !isExpanded);
            navList.classList.toggle('nav-open');
        });

        // Close menu when clicking outside or on a link
        document.addEventListener('click', (e) => {
            if (!hamburgerBtn.contains(e.target) && !navList.contains(e.target)) {
                hamburgerBtn.setAttribute('aria-expanded', 'false');
                navList.classList.remove('nav-open');
            }
        });

        // Close menu when a link is clicked
        navList.addEventListener('click', (e) => {
            if (e.target.classList.contains('nav-link')) {
                hamburgerBtn.setAttribute('aria-expanded', 'false');
                navList.classList.remove('nav-open');
            }
        });
    }
}

// Auto-initialize when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => Header.init());
} else {
    Header.init();
}

// Export for module systems
if (typeof module !== 'undefined' && module.exports) {
    module.exports = Header;
}



// ===== models/DataManager.js =====
/**
 * Data Manager Model
 * Core data operations using localStorage and file services
 * @module models/DataManager
 */

const DataManager = {
    STORAGE_KEY_MONTHS: 'money_tracker_months',
    STORAGE_KEY_POTS: 'money_tracker_pots',
    STORAGE_KEY_SETTINGS: 'money_tracker_settings',

    /**
     * Initialize default settings if they don't exist
     * @returns {Object} Settings object
     */
    initializeSettings() {
        const existingSettings = this.getSettings();
        if (!existingSettings) {
            const defaultSettings = {
                currency: '£',
                defaultFixedCosts: [],
                defaultVariableCategories: ['Food', 'Travel/Transport', 'Activities'],
                defaultPots: []
            };
            this.saveSettings(defaultSettings);
            return defaultSettings;
        }
        return existingSettings;
    },

    /**
     * Get all months data from localStorage
     * @returns {Object} Object with all months keyed by monthKey
     */
    getAllMonths() {
        return window.StorageService.get(this.STORAGE_KEY_MONTHS) || {};
    },

    /**
     * Save all months data to localStorage
     * @param {Object} monthsData - Object with all months
     * @returns {boolean} Success status
     */
    saveAllMonths(monthsData) {
        return window.StorageService.set(this.STORAGE_KEY_MONTHS, monthsData);
    },

    /**
     * Get a specific month's data from localStorage
     * @param {string} monthKey - Month key (e.g., "2025-11")
     * @returns {Object|null} Month data or null
     */
    getMonth(monthKey) {
        const allMonths = this.getAllMonths();
        return allMonths[monthKey] || null;
    },

    /**
     * Save a specific month's data to localStorage and export as file
     * @param {string} monthKey - Month key
     * @param {Object} monthData - Month data object
     * @param {boolean} exportFile - Whether to export to file
     * @returns {boolean} Success status
     */
    saveMonth(monthKey, monthData, exportFile = true) {
        if (!monthKey || !monthData) {
            throw new Error('Month key and data are required');
        }

        monthData.updatedAt = new Date().toISOString();
        if (!monthData.createdAt) {
            monthData.createdAt = new Date().toISOString();
        }
        
        const allMonths = this.getAllMonths();
        allMonths[monthKey] = monthData;
        const saved = this.saveAllMonths(allMonths);
        
        if (saved && exportFile && window.ExportService) {
            window.ExportService.exportMonthToFile(monthKey, monthData, 'json').catch(error => {
                console.error('Error exporting month file:', error);
            });
        }
        
        return saved;
    },

    /**
     * Delete a month from localStorage
     * @param {string} monthKey - Month key
     * @returns {boolean} Success status
     */
    deleteMonth(monthKey) {
        const allMonths = this.getAllMonths();
        delete allMonths[monthKey];
        return this.saveAllMonths(allMonths);
    },

    /**
     * Load all months from individual JSON files into localStorage
     * @returns {Promise<Object>} Object with all months
     */
    async loadMonthsFromFiles() {
        if (!window.FileService) {
            console.error('FileService not available');
            return this.getAllMonths();
        }

        const fileMonths = await window.FileService.loadAllMonthsFromFiles();
        const localStorageMonths = this.getAllMonths();
        
        const allMonths = { ...fileMonths };
        Object.keys(localStorageMonths).forEach(key => {
            if (!allMonths[key]) {
                allMonths[key] = localStorageMonths[key];
            }
        });

        if (Object.keys(fileMonths).length > 0) {
            this.saveAllMonths(allMonths);
        }

        return allMonths;
    },

    /**
     * Load months from file picker
     * @returns {Promise<Object>} Result object
     */
    async loadMonthsFromFilePicker() {
        if (!window.FileService) {
            return { success: false, message: 'FileService not available', useFileInput: true };
        }
        return await window.FileService.loadMonthsFromFilePicker();
    },

    /**
     * Load months from file input
     * @param {FileList} files - File list
     * @returns {Promise<Object>} Result object
     */
    async loadMonthsFromFileInput(files) {
        if (!window.FileService) {
            return { success: false, count: 0, errors: files.length, months: {} };
        }
        const result = await window.FileService.loadMonthsFromFileInput(files);
        if (result.success && result.months) {
            const allMonths = this.getAllMonths();
            Object.assign(allMonths, result.months);
            this.saveAllMonths(allMonths);
        }
        return result;
    },

    /**
     * Save all months to files
     * @returns {Promise<Object>} Result object
     */
    async saveAllMonthsToFiles() {
        if (!window.ExportService) {
            return { success: false, message: 'ExportService not available' };
        }
        const allMonths = this.getAllMonths();
        return await window.ExportService.saveAllMonthsToFiles(allMonths);
    },

    /**
     * Export month to file
     * @param {string} monthKey - Month key
     * @param {Object} monthData - Month data
     * @param {string} format - Format ('json', 'csv', 'html')
     * @returns {Promise<boolean>} Success status
     */
    async exportMonthToFile(monthKey, monthData, format = 'json') {
        if (!window.ExportService) {
            console.error('ExportService not available');
            return false;
        }
        return await window.ExportService.exportMonthToFile(monthKey, monthData, format);
    },

    /**
     * Get all pots data
     * @returns {Object} Pots data object
     */
    getAllPots() {
        return window.StorageService.get(this.STORAGE_KEY_POTS) || {};
    },

    /**
     * Save all pots data
     * @param {Object} potsData - Pots data object
     * @returns {boolean} Success status
     */
    saveAllPots(potsData) {
        return window.StorageService.set(this.STORAGE_KEY_POTS, potsData);
    },

    /**
     * Get settings
     * @returns {Object|null} Settings object or null
     */
    getSettings() {
        return window.StorageService.get(this.STORAGE_KEY_SETTINGS);
    },

    /**
     * Save settings
     * @param {Object} settings - Settings object
     * @returns {boolean} Success status
     */
    saveSettings(settings) {
        return window.StorageService.set(this.STORAGE_KEY_SETTINGS, settings);
    },

    /**
     * Generate a month key from year and month
     * @param {number} year - Year
     * @param {number} month - Month (1-12)
     * @returns {string} Month key
     */
    generateMonthKey(year, month) {
        return window.MonthFactory.generateMonthKey(year, month);
    },

    /**
     * Parse month key to year and month
     * @param {string} monthKey - Month key
     * @returns {Object} Object with year and month
     */
    parseMonthKey(monthKey) {
        return window.MonthFactory.parseMonthKey(monthKey);
    },

    /**
     * Get month name from month number
     * @param {number} monthNumber - Month number (1-12)
     * @returns {string} Month name
     */
    getMonthName(monthNumber) {
        return window.MonthFactory.getMonthName(monthNumber);
    },

    /**
     * Create a new month with default structure
     * @param {number} year - Year
     * @param {number} month - Month (1-12)
     * @returns {Object} New month data object
     */
    createNewMonth(year, month) {
        const settings = this.getSettings() || this.initializeSettings();
        const newMonth = window.MonthFactory.createNewMonth(year, month, settings);
        const monthKey = newMonth.key;
        this.saveMonth(monthKey, newMonth, true);
        return newMonth;
    },

    /**
     * Calculate totals for a month
     * @param {Object} monthData - Month data object
     * @returns {Object} Totals object
     */
    calculateMonthTotals(monthData) {
        if (!window.CalculationService) {
            throw new Error('CalculationService not available');
        }
        return window.CalculationService.calculateMonthTotals(monthData);
    },

    /**
     * Generate HTML representation of month data
     * @param {Object} monthData - Month data object
     * @param {string} monthKey - Month key
     * @returns {string} HTML string
     */
    monthDataToHTML(monthData, monthKey) {
        if (!window.ExportService) {
            throw new Error('ExportService not available');
        }
        return window.ExportService.monthDataToHTML(monthData, monthKey);
    }
};

if (typeof window !== 'undefined') {
    DataManager.initializeSettings();
    window.DataManager = DataManager;
}


// ===== utils/formatters.js =====
/**
 * Utility Functions
 * Shared formatting and helper functions
 */

const Formatters = {
    /**
     * Get currency symbol from settings
     */
    getCurrencySymbol() {
        if (typeof window !== 'undefined' && window.DataManager) {
            const settings = DataManager.getSettings();
            if (settings && settings.currency) {
                return settings.currency;
            }
        }
        return '£'; // Default to £
    },

    /**
     * Format currency amount
     */
    formatCurrency(amount) {
        const currencySymbol = this.getCurrencySymbol();
        return currencySymbol + parseFloat(amount || 0).toFixed(2);
    },

    /**
     * Format date for display
     */
    formatDate(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        return date.toLocaleDateString();
    },

    /**
     * Parse number safely
     */
    parseNumber(value) {
        const parsed = parseFloat(value || 0);
        return isNaN(parsed) ? 0 : parsed;
    },

    /**
     * Validate year input
     */
    validateYear(year) {
        const yearNum = parseInt(year, 10);
        return !isNaN(yearNum) && yearNum >= 2000 && yearNum <= 2100;
    },

    /**
     * Validate month input
     */
    validateMonth(month) {
        const monthNum = parseInt(month, 10);
        return !isNaN(monthNum) && monthNum >= 1 && monthNum <= 12;
    }
};

// Make available globally
if (typeof window !== 'undefined') {
    window.Formatters = Formatters;
}



// ===== controllers/PotsController.js =====
/**
 * Pots & Investments Controller
 * Handles the pots and investments view logic
 */

const PotsController = {
    potsData: {},

    /**
     * Initialize the pots page
     */
    init() {
        this.loadPotsData();
        this.setupEventListeners();
    },

    /**
     * Setup event listeners
     */
    setupEventListeners() {
        const addPotBtn = document.getElementById('add-pot-button');
        if (addPotBtn) {
            addPotBtn.addEventListener('click', () => this.addPotRow());
        }
    },

    /**
     * Load pots data from all months
     */
    loadPotsData() {
        const allMonths = DataManager.getAllMonths();
        const potsMap = {};

        Object.keys(allMonths).forEach(monthKey => {
            const monthData = allMonths[monthKey];
            if (monthData.pots && Array.isArray(monthData.pots)) {
                monthData.pots.forEach(pot => {
                    const category = pot.category || 'Unnamed';
                    if (!potsMap[category]) {
                        potsMap[category] = {
                            category: category,
                            estimatedAmount: 0,
                            actualAmount: 0,
                            months: []
                        };
                    }
                    potsMap[category].estimatedAmount += Formatters.parseNumber(pot.estimatedAmount);
                    potsMap[category].actualAmount += Formatters.parseNumber(pot.actualAmount);
                    potsMap[category].months.push({
                        monthKey: monthKey,
                        monthName: monthData.monthName || DataManager.getMonthName(monthData.month),
                        year: monthData.year,
                        estimatedAmount: Formatters.parseNumber(pot.estimatedAmount),
                        actualAmount: Formatters.parseNumber(pot.actualAmount)
                    });
                });
            }
        });

        this.potsData = potsMap;
        this.renderPotsTable();
        this.renderPotsByMonth();
        this.updateTotals();
    },

    /**
     * Render pots table
     */
    renderPotsTable() {
        const tbody = document.getElementById('pots-tbody');
        if (!tbody) return;
        tbody.innerHTML = '';

        const categories = Object.keys(this.potsData).sort();

        categories.forEach(category => {
            const pot = this.potsData[category];
            const row = document.createElement('tr');
            
            row.innerHTML = `
                <td><strong>${category}</strong></td>
                <td>${Formatters.formatCurrency(pot.estimatedAmount)}</td>
                <td>${Formatters.formatCurrency(pot.actualAmount)}</td>
                <td><button type="button" class="delete-row-x" aria-label="Delete row" data-category="${category}">×</button></td>
            `;

            const deleteBtn = row.querySelector('.delete-row-x');
            if (deleteBtn) {
                deleteBtn.addEventListener('click', () => {
                if (confirm(`Are you sure you want to remove all entries for "${category}"? This will remove it from all months.`)) {
                    this.removePotFromAllMonths(category);
                }
            });
            }

            tbody.appendChild(row);
        });

        // Add total row
        const totalRow = document.createElement('tr');
        totalRow.className = 'total-row';
        totalRow.innerHTML = `
            <td><strong>Total</strong></td>
            <td id="pots-total-estimated"><strong>£0.00</strong></td>
            <td id="pots-total-actual"><strong>£0.00</strong></td>
            <td></td>
        `;
        tbody.appendChild(totalRow);
    },

    /**
     * Render pots by month
     */
    renderPotsByMonth() {
        const container = document.getElementById('pots-by-month-container');
        if (!container) return;

        const allMonths = DataManager.getAllMonths();
        const monthKeys = Object.keys(allMonths).sort().reverse();

        if (monthKeys.length === 0) {
            container.innerHTML = '<p class="empty-message">No monthly data available.</p>';
            return;
        }

        container.innerHTML = monthKeys.map(monthKey => {
            const monthData = allMonths[monthKey];
            const monthName = monthData.monthName || DataManager.getMonthName(monthData.month);
            const pots = monthData.pots || [];

            if (pots.length === 0) {
                return `
                    <div class="form-section" style="margin-bottom: 1rem;">
                        <h3>${monthName} ${monthData.year}</h3>
                        <p class="empty-message">No pots for this month.</p>
                        <a href="monthly-budget.html?month=${monthKey}" class="btn btn-action">Edit Month</a>
                    </div>
                `;
            }

            const potsHtml = pots.map(pot => `
                <tr>
                    <td>${pot.category || 'Unnamed'}</td>
                    <td>${Formatters.formatCurrency(pot.estimatedAmount || 0)}</td>
                    <td>${Formatters.formatCurrency(pot.actualAmount || 0)}</td>
                </tr>
            `).join('');

            const totals = pots.reduce((acc, pot) => {
                acc.estimated += Formatters.parseNumber(pot.estimatedAmount);
                acc.actual += Formatters.parseNumber(pot.actualAmount);
                return acc;
            }, { estimated: 0, actual: 0 });

            return `
                <div class="form-section" style="margin-bottom: 1rem;">
                    <h3>${monthName} ${monthData.year}</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Estimated Amount</th>
                                <th>Actual Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${potsHtml}
                            <tr class="total-row">
                                <td><strong>Total</strong></td>
                                <td><strong>${Formatters.formatCurrency(totals.estimated)}</strong></td>
                                <td><strong>${Formatters.formatCurrency(totals.actual)}</strong></td>
                            </tr>
                        </tbody>
                    </table>
                    <a href="monthly-budget.html?month=${monthKey}" class="btn btn-action" style="margin-top: 1rem;">Edit Month</a>
                </div>
            `;
        }).join('');
    },

    /**
     * Add pot row (creates a new pot category)
     */
    addPotRow() {
        const category = prompt('Enter pot category name:');
        if (!category || category.trim() === '') return;

        const categoryKey = category.trim();
        
        if (this.potsData[categoryKey]) {
            alert('This pot category already exists. You can add it to a specific month from the Monthly Budget page.');
            return;
        }

        this.potsData[categoryKey] = {
            category: categoryKey,
            estimatedAmount: 0,
            actualAmount: 0,
            months: []
        };

        this.renderPotsTable();
        this.updateTotals();
    },

    /**
     * Remove pot from all months
     */
    removePotFromAllMonths(category) {
        const allMonths = DataManager.getAllMonths();
        let modified = false;

        Object.keys(allMonths).forEach(monthKey => {
            const monthData = allMonths[monthKey];
            if (monthData.pots && Array.isArray(monthData.pots)) {
                const originalLength = monthData.pots.length;
                monthData.pots = monthData.pots.filter(pot => (pot.category || '') !== category);
                if (monthData.pots.length !== originalLength) {
                    monthData.updatedAt = new Date().toISOString();
                    DataManager.saveMonth(monthKey, monthData);
                    modified = true;
                }
            }
        });

        if (modified) {
            this.loadPotsData();
            alert('Pot removed from all months.');
        }
    },

    /**
     * Update totals display
     */
    updateTotals() {
        const totals = Object.values(this.potsData).reduce((acc, pot) => {
            acc.estimated += pot.estimatedAmount;
            acc.actual += pot.actualAmount;
            return acc;
        }, { estimated: 0, actual: 0 });

        const estimatedEl = document.getElementById('total-pots-estimated');
        const actualEl = document.getElementById('total-pots-actual');
        const totalEstimatedEl = document.getElementById('pots-total-estimated');
        const totalActualEl = document.getElementById('pots-total-actual');

        if (estimatedEl) estimatedEl.textContent = Formatters.formatCurrency(totals.estimated);
        if (actualEl) actualEl.textContent = Formatters.formatCurrency(totals.actual);
        if (totalEstimatedEl) totalEstimatedEl.innerHTML = '<strong>' + Formatters.formatCurrency(totals.estimated) + '</strong>';
        if (totalActualEl) totalActualEl.innerHTML = '<strong>' + Formatters.formatCurrency(totals.actual) + '</strong>';
    }
};

// Initialize when DOM is ready
// Make available globally
window.PotsController = PotsController;




// ===== Inline Scripts =====

// Inline script 1

        // Initialize settings and load months
        document.addEventListener('DOMContentLoaded', async function() {
            DataManager.initializeSettings();
            await DataManager.loadMonthsFromFiles();
            
            // Now initialize the controller
            if (window.PotsController) {
                await window.PotsController.init();
            }
        });
    
</script>
</body>
</html>

