# Claude Code - Project Instructions

## Git Commit Conventions

### CRITICAL: No AI Co-Author Attribution
**NEVER add `Co-Authored-By: Claude` or any AI or human co-author attribution in commit messages.**

The repository owner prefers commits without AI or any co-author attribution lines.

### Commit Message Format
- First line: Short summary (50 chars or less)
- Body: Detailed explanation if needed
- Use present tense ("Add feature" not "Added feature")
- Reference issue numbers when applicable

### Git Workflow
**CRITICAL: No Uncommitted Code**
- There must **NEVER** be uncommitted changes left in the working tree
- Every change must have a purpose: either commit it or discard it
- Before completing any task, run `git status` to check for uncommitted changes
- If changes exist:
  - If they have purpose → Commit them with proper message
  - If they don't → Discard them with `git restore <file>`
- Working tree must always be clean before declaring work complete

## Code Style Conventions

### JavaScript
- Use ES6+ syntax (const/let, arrow functions, async/await)
- Avoid `var` declarations
- Use `window.` prefix for global service access
- Always use semicolons
- Use 4-space indentation

### Naming Conventions
- Services: PascalCase with "Service" suffix (e.g., `AuthService`)
- Controllers: PascalCase with "Controller" suffix (e.g., `MessengerController`)
- Utilities: camelCase (e.g., `formatters.js`)
- Constants: UPPER_SNAKE_CASE

## Security Requirements

### End-to-End Encryption
- NEVER store plaintext private keys in database
- NEVER send plaintext keys to server
- Use PBKDF2-SHA256 with ≥600,000 iterations (OWASP 2023)
- Use AES-256-GCM for authenticated encryption
- Validate all encryption parameters before use

### Password Handling
- NEVER store passwords permanently
- Use sessionStorage for temporary storage (max 10 minutes)
- Clear password from memory immediately after use
- Always use Web Crypto API for cryptographic operations

### Input Validation
- Sanitize all user inputs
- Validate on both client and server side
- Use parameterized queries for database operations
- Escape HTML output to prevent XSS

## Database Conventions

### Table Naming
- Use snake_case (e.g., `user_key_backups`)
- Singular names for lookup tables
- Always enable Row Level Security (RLS)
- Include timestamps: `created_at`, `updated_at`

### RLS Policies
- Always create policies for SELECT, INSERT, UPDATE, DELETE
- Use `auth.uid()` for user-specific access
- Name policies descriptively: `tablename_action_scope`

## Error Handling

### Logging
- Use console.log for informational messages
- Use console.warn for recoverable issues
- Use console.error for errors
- Include service name in brackets: `[ServiceName] Message`

---

**Last Updated**: January 2026
**Maintainer**: Nicholas Antoniades
